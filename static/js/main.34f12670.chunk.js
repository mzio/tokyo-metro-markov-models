(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{58:function(e,t,a){e.exports=a(99)},64:function(e,t,a){},93:function(e,t,a){},99:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(15),i=a.n(r),l=(a(64),a(16)),s=a(17),c=a(22),u=a(18),h=a(21),d=a(7),p=a(28),m=a.n(p),b=a(103),v=a(105),f=a(104),g=a(102),k=a(101),y=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={line:"all",buttonText:"Start",showAbout:!1},a.handleLineSelect=a.handleLineSelect.bind(Object(d.a)(Object(d.a)(a))),a.handleClose=a.handleClose.bind(Object(d.a)(Object(d.a)(a))),a.handleShow=a.handleShow.bind(Object(d.a)(Object(d.a)(a))),a}return Object(h.a)(t,e),Object(s.a)(t,[{key:"handleLineSelect",value:function(e){console.log(e.target.value),this.setState({line:e.target.value}),console.log(this.state)}},{key:"handleClose",value:function(){this.setState({showAbout:!1})}},{key:"handleShow",value:function(){this.setState({showAbout:!0})}},{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(b.a,{size:"lg",show:this.state.showAbout,onHide:this.handleClose,backdropClassName:"modalBackdrop"},o.a.createElement(b.a.Header,{closeButton:!0},o.a.createElement(b.a.Title,null,"About")),o.a.createElement(b.a.Body,null,o.a.createElement("p",null,"A little side project to display Tokyo Metro travel averaged over a single day. Visualization is generated through a client-side simulation determined by the hour, using markov chains calculated from data on Foursquare check-ins from 2012 to 2013. To run, select an hour or hit start, which will auto-reload the simulation at every hour."),o.a.createElement("p",null,"See ",o.a.createElement("a",{href:"#"},"[here]")," for more info. Briefly, Foursquare check-in data was filtered for subway stations and cross-referenced with station geocoordinates belonging to the Tokyo Metro and Toei Subway subway system lines. From only knowing check-in data, directionality was inferred with transition matrices for each line based on the ratio of station to overall line check-ins. To try to capture possible changes in distribution over the day, matrices were constructed for each hour."),o.a.createElement("p",null,"Final note: as part of a side project creation thing this is mostly untested on mobile or any browser other than Chrome. Feel free to report any bugs at the link below."),o.a.createElement("p",null,"Creds:"),o.a.createElement("ul",null,o.a.createElement("li",null,o.a.createElement("a",{href:"https://www.kaggle.com/chetanism/foursquare-nyc-and-tokyo-checkin-dataset/version/2#dataset_TSMC2014_TKY.csv"},"[Tokyo Foursquare Check-in Data]")),o.a.createElement("li",null,o.a.createElement("a",{href:"https://www.npmjs.com/package/japan-train-data"},"[Japan Train Geocoordinate Data \ud83d\ude89 \ud83d\ude89 \ud83d\ude89]"))),o.a.createElement("p",null,"Code available on"," ",o.a.createElement("a",{href:"https://github.com/mzio/tokyo-metro-map/tree/master/app"},"[Github]"),"."),o.a.createElement("p",null,"See more projects / get contact info to report bugs"," ",o.a.createElement("a",{href:"https://michaelzhang.xyz/"},"[here]"),"."))),o.a.createElement(v.a,{bg:"dark",expand:"lg",variant:"dark"},o.a.createElement(f.a,{href:"#",className:"navElement"},o.a.createElement("h3",null,"Tokyo Metro Markov Models")),o.a.createElement(v.a.Toggle,{"aria-controls":"responsive-navbar-nav"}),o.a.createElement(v.a.Collapse,{id:"responsive-navbar-nav"},o.a.createElement(g.a,{inline:!0,className:"navElement"},o.a.createElement(g.a.Label,{className:"formInlineLabel"},"Hit start or select a time here:"),o.a.createElement(g.a.Control,{as:"select",onChange:this.props.handleTimeClick},o.a.createElement("option",null,"00:00"),o.a.createElement("option",null,"01:00"),o.a.createElement("option",null,"02:00"),o.a.createElement("option",null,"03:00"),o.a.createElement("option",null,"04:00"),o.a.createElement("option",null,"05:00"),o.a.createElement("option",null,"06:00"),o.a.createElement("option",null,"07:00"),o.a.createElement("option",null,"08:00"),o.a.createElement("option",null,"09:00"),o.a.createElement("option",null,"10:00"),o.a.createElement("option",null,"11:00"),o.a.createElement("option",null,"12:00"),o.a.createElement("option",null,"13:00"),o.a.createElement("option",null,"14:00"),o.a.createElement("option",null,"15:00"),o.a.createElement("option",null,"16:00"),o.a.createElement("option",null,"17:00"),o.a.createElement("option",null,"18:00"),o.a.createElement("option",null,"19:00"),o.a.createElement("option",null,"20:00"),o.a.createElement("option",null,"21:00"),o.a.createElement("option",null,"22:00"),o.a.createElement("option",null,"23:00")),o.a.createElement(k.a,{variant:"outline-light",className:"navElement",onClick:this.props.handleStartClick},this.props.buttonText),o.a.createElement(g.a.Label,{className:"formInlineLabel"},"Time: ",this.props.time),o.a.createElement(g.a.Label,{className:"formInlineLabel"},o.a.createElement("a",{href:"#",onClick:this.handleShow},"[Click here for about / intro]"))))))}}]),t}(o.a.Component),E=a(6),j=(a(98),a(37)),w=a(42),O=a(57),S=a(34),x=(a(33),function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={line:a.props.line,hour:a.props.hour,links:[],nodes:[],loaded:!1},a.updateNodes=a.updateNodes.bind(Object(d.a)(Object(d.a)(a))),a.updateLinks=a.updateLinks.bind(Object(d.a)(Object(d.a)(a))),a.getD3=a.getD3.bind(Object(d.a)(Object(d.a)(a))),a}return Object(h.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.container=this.props.map.getCanvasContainer(),this.paths={},this.updateNodes(),this.updateLinks()}},{key:"componentDidUpdate",value:function(e){e.line!==this.props.line&&(Object(E.d)("svg").remove(),this.updateNodes(),this.updateLinks()),e.hour!==this.props.hour&&(Object(E.d)("svg").remove(),console.log(this.props.hour),this.updateLinks(),this.updateNodes())}},{key:"getD3",value:function(){var e=this.props.map,t=document.body.getBoundingClientRect(),a=e.getCenter(),n=e.getZoom(),o=256/Math.PI*Math.pow(2,n);return Object(j.a)().center([a.lng,a.lat]).translate([t.width/2,t.height/2]).scale(o)}},{key:"updateNodes",value:function(){this.d3Projection=this.getD3(),Object(j.b)().projection(this.d3Projection);var e=this;function t(t,a){var n=Object(E.c)(t).append("svg").selectAll("circle.dot").data(a);n.exit().remove(),n.enter().append("circle").classed("dot",!0).attr("r",7).styles({fill:function(e){return e.line_color},"fill-opacity":0,stroke:"#004d60","stroke-width":0,"z-index":1e3}).attrs({cx:function(t){return e.d3Projection([t.longitude,t.latitude])[0]},cy:function(t){return e.d3Projection([t.longitude,t.latitude])[1]}})}Object(w.a)("/tokyo-metro-markov-models/lines_nodes.json").then(function(a){if(e.setState({nodes:a}),"all"!==e.props.line)t(e.container,a[e.props.line]);else for(var n in a)t(e.container,a[n])})}},{key:"updateLinks",value:function(){this.d3Projection=this.getD3(),Object(j.b)().projection(this.d3Projection);var e=this;function t(t,a,n){var o=n.replace(/\s+/g,"");try{t.append("g").selectAll(".link_"+o).data(a).enter().append("path").attr("class","link_"+o).styles({stroke:function(e){return e.color},"stroke-width":5,"stroke-opacity":.075,"z-index":1e3}).attr("d",function(t){try{var a=e.state.nodes[n].find(function(e){return e.name===t.source}),o=e.state.nodes[n].find(function(e){return e.name===t.target}),r=e.d3Projection([a.longitude,a.latitude])[0],i=e.d3Projection([a.longitude,a.latitude])[1],l=e.d3Projection([o.longitude,o.latitude])[0],s=e.d3Projection([o.longitude,o.latitude])[1]}catch(h){}var c=t.value;c<10&&(c=20);for(var u=0;u<c;u++)e.paths[n].push({source:t.source,target:t.target,start:[r,i],end:[l,s],color:t.color});return"M"+r+","+i+"L"+l+","+s})}catch(r){}}function a(t,a,n){var o=Object(O.a)(a,function(e){return e.value}),r=e.paths[n],i=[];try{var l=Math.max(Math.floor(o/40),1)}catch(d){console.log(d)}for(var s=0;s<l;s++){var c=r[Math.floor(Math.random()*r.length)];i.push({ix:s,path:c,opacity:1})}var u={},h=t.selectAll("circle.dot").data(i).enter().append("circle").classed("dot",!0).attr("r",2).styles({fill:c.color,"fill-opacity":1,stroke:c.color,"stroke-width":6,"stroke-opacity":.3,"z-index":1e3}).attrs({cx:function(e){return e.path.start[0]},cy:function(e){return e.path.start[1]}}).each(function(e){u[e.ix]=[e.path.end[0],e.path.end[1],e.path.target,e.opacity,1]});e.timer=setInterval(function(){h.transition().duration(0).styles({"fill-opacity":function(e){return u[e.ix][3]},"stroke-opacity":function(e){return u[e.ix][3]-.7}}).transition().ease(S.b).duration(360).attr("cx",function(e){return u[e.ix][0]}).attr("cy",function(e){return u[e.ix][1]}).each(function(t){var a=e.paths[n].filter(function(e){return e.source===u[t.ix][2]}),o=u[t.ix][4];if(a.length>0){var i=a[Math.floor(Math.random()*a.length)];u[t.ix]=1===o?[i.end[0],i.end[1],i.target,1,1]:[i.end[0],i.end[1],i.target,0,1]}else{var l=r[Math.floor(Math.random()*r.length)];u[t.ix]=[l.end[0],l.end[1],l.target,0,0]}})},360)}Object(w.a)("/tokyo-metro-markov-models/lines_links.json").then(function(n){var o=n[e.props.hour];if("all"!==e.props.line)t(e.container,o[e.props.line],e.props.line);else for(var r in o){var i=Object(E.c)(e.container).append("svg");e.paths[r]=[],t(i,o[r],r),e.paths[r].length>0&&a(i,o[r],r)}})}},{key:"render",value:function(){return o.a.createElement("div",null)}}]),t}(o.a.Component)),T=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={viewport:{container:"map",style:a.props.style,center:a.props.center,zoom:a.props.zoom},rendered:!1},a}return Object(h.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.map=new m.a.Map(this.state.viewport),this.setState({rendered:!0})}},{key:"render",value:function(){return this.state.rendered?o.a.createElement("div",null,o.a.createElement("div",{id:"map"}),o.a.createElement(x,{map:this.map,line:this.props.line,hour:this.props.hour,buttonText:this.props.startButtonText})):o.a.createElement("div",{id:"map"})}}]),t}(o.a.Component);a(93);a(95).config(),m.a.accessToken="pk.eyJ1IjoibXppbyIsImEiOiJjajM3YzVpbGkwMGgyMnFvMmE2ZWxoMWs3In0.CcIzbqMViGz_OQmZ9_v3nw";var C=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={time:"00:00",line:"all",startButtonText:"Start",seconds:0},a.handleLineSelect=a.handleLineSelect.bind(Object(d.a)(Object(d.a)(a))),a.handleStart=a.handleStart.bind(Object(d.a)(Object(d.a)(a))),a.handleTimeSelect=a.handleTimeSelect.bind(Object(d.a)(Object(d.a)(a))),a}return Object(h.a)(t,e),Object(s.a)(t,[{key:"handleLineSelect",value:function(e){this.setState({line:e.target.value})}},{key:"handleTimeSelect",value:function(e){var t=e.target.value.substring(0,2),a=3600*parseInt(t,10);this.setState({seconds:a});var n=new Date(null);n.setSeconds(a),console.log(a);var o=n.toISOString().substr(11,5);this.setState({time:o})}},{key:"handleStart",value:function(e){var t=this;"Start"===this.state.startButtonText?(this.setState({startButtonText:"Pause"}),this.timer=setInterval(function(){t.state.seconds>=86399?t.setState({seconds:0}):t.setState({seconds:t.state.seconds+=10});var e=new Date(null);e.setSeconds(t.state.seconds);var a=e.toISOString().substr(11,5);t.setState({time:a})},10)):(this.setState({startButtonText:"Start"}),clearInterval(this.timer))}},{key:"render",value:function(){var e={style:"mapbox://styles/mapbox/dark-v9",center:[139.7586,35.6909],zoom:11.5,line:this.state.line,hour:parseInt(this.state.time.substring(0,2),10),startButtonText:this.state.startButtonText};return o.a.createElement("div",null,o.a.createElement("div",{id:"map"}),o.a.createElement(T,e),o.a.createElement(y,{handleChange:this.handleLineSelect,handleStartClick:this.handleStart,handleTimeClick:this.handleTimeSelect,time:this.state.time,buttonText:this.state.startButtonText}))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(C,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[58,2,1]]]);
//# sourceMappingURL=main.34f12670.chunk.js.map